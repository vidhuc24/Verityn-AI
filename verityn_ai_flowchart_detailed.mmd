
graph TB
    %% Title
    subgraph "VERITYN AI - MULTI-AGENT DOCUMENT CHAT SYSTEM"
    
    %% User Interface Layer
    subgraph "User Interface Layer"
        A[ğŸ‘¤ User/Auditor<br/>â€¢ Upload Document<br/>â€¢ Ask Questions<br/>â€¢ View Results]
        B[ğŸ–¥ï¸ Next.js Frontend<br/>â€¢ Document Upload<br/>â€¢ Chat Interface<br/>â€¢ Smart Questions<br/>â€¢ Progress Feedback]
        C[ğŸ”§ FastAPI Backend<br/>â€¢ Multi-Agent Orchestration<br/>â€¢ API Endpoints<br/>â€¢ Error Handling]
    end
    
    %% Multi-Agent Workflow Layer
    subgraph "Multi-Agent Workflow"
        D[ğŸ“„ Document Processing Agent<br/>â€¢ Extract Text<br/>â€¢ Chunk Content<br/>â€¢ Generate Embeddings]
        E[ğŸ·ï¸ Classification Agent<br/>â€¢ Identify Type<br/>â€¢ SOX Controls<br/>â€¢ Risk Level<br/>â€¢ Compliance Framework]
        F[â“ Question Analysis Agent<br/>â€¢ Understand Intent<br/>â€¢ Optimize Query<br/>â€¢ Context Awareness]
        G[ğŸ” Context Retrieval Agent<br/>â€¢ Hybrid Search<br/>â€¢ Query Expansion<br/>â€¢ Multi-Hop<br/>â€¢ Metadata Filtering]
        H[ğŸ“ Response Synthesis Agent<br/>â€¢ Combine Context<br/>â€¢ Generate Response<br/>â€¢ Source Citations]
        I[âš–ï¸ Compliance Analyzer Agent<br/>â€¢ Risk Assessment<br/>â€¢ Compliance Validation<br/>â€¢ Control Mapping]
    end
    
    %% Advanced Retrieval Layer
    subgraph "Advanced Retrieval Techniques"
        J1[ğŸ”— Hybrid Search<br/>Semantic + Keyword]
        J2[ğŸ”¤ Query Expansion<br/>Audit Terminology]
        J3[ğŸ”„ Multi-Hop Retrieval<br/>Comprehensive Analysis]
        J4[ğŸ·ï¸ Metadata Filtering<br/>Type, Framework, Risk]
        J5[ğŸ’¬ Conversational Retrieval<br/>Context Preservation]
        J6[ğŸ¯ Classification-Enhanced<br/>Type-Specific Optimization]
        J7[ğŸª Ensemble Retrieval<br/>Multiple Techniques]
    end
    
    %% Data Processing Layer
    subgraph "Data Processing Layer"
        K[âœ‚ï¸ Document Chunking<br/>â€¢ 1000-char chunks<br/>â€¢ 250-char overlap<br/>â€¢ Preserve Structure]
        L[ğŸ§  Embedding Generation<br/>â€¢ OpenAI text-embedding-3-small<br/>â€¢ Semantic Vectors<br/>â€¢ High Quality]
        M[ğŸ—„ï¸ Vector Database - Qdrant<br/>â€¢ Similarity Search<br/>â€¢ Fast Retrieval<br/>â€¢ Metadata Storage]
        N[ğŸ“Š Metadata Storage<br/>â€¢ Document Type<br/>â€¢ Compliance Framework<br/>â€¢ Risk Level<br/>â€¢ Company Info]
    end
    
    %% LLM Integration
    subgraph "LLM Integration"
        O[ğŸ¤– OpenAI GPT-4<br/>â€¢ Superior Reasoning<br/>â€¢ Compliance Analysis<br/>â€¢ Response Generation<br/>â€¢ Context Awareness]
    end
    
    %% External Integrations
    subgraph "External Integrations"
        P[ğŸŒ Tavily API<br/>â€¢ Real-time Regulatory Guidance<br/>â€¢ Current Compliance Info<br/>â€¢ Best Practices<br/>â€¢ Framework Updates]
    end
    
    %% Evaluation & Monitoring
    subgraph "Evaluation & Monitoring"
        R[ğŸ“ˆ RAGAS Evaluation<br/>â€¢ Faithfulness: 0.850<br/>â€¢ Relevancy: 0.780<br/>â€¢ Precision: 0.820<br/>â€¢ Recall: 0.750]
        S[ğŸ“Š Performance Monitoring - LangSmith<br/>â€¢ Real-time Metrics<br/>â€¢ Performance Tracking<br/>â€¢ Debugging<br/>â€¢ Optimization]
        T[âœ… Quality Assessment<br/>â€¢ Success Rate: 100%<br/>â€¢ Response Length: 1,478-1,651 chars<br/>â€¢ Execution Time: 28-36s]
        U[ğŸ’¼ Business Impact<br/>â€¢ Classification Accuracy: 95%+<br/>â€¢ Compliance Relevance: 90%+<br/>â€¢ Risk Identification: 85%+<br/>â€¢ Production Ready]
    end
    
    %% Performance Metrics Summary
    subgraph "Performance Metrics Summary"
        V[ğŸ¯ Key Achievements<br/>âœ… 100% Success Rate (Both Systems)<br/>âœ… 12% Response Quality Improvement<br/>âœ… Production-Ready Stability<br/>âœ… Quality-Focused Approach<br/>âœ… Comprehensive Evaluation]
    end
    
    end
    
    %% Flow Connections
    A --> B
    B --> C
    C --> D
    D --> E
    E --> F
    F --> G
    G --> H
    H --> I
    G --> J1
    G --> J2
    G --> J3
    G --> J4
    G --> J5
    G --> J6
    G --> J7
    D --> K
    K --> L
    L --> M
    M --> N
    H --> O
    I --> O
    O --> P
    P --> H
    H --> R
    I --> S
    H --> T
    I --> U
    R --> V
    S --> V
    T --> V
    U --> V
    
    %% Styling
    classDef userInterface fill:#E3F2FD,stroke:#1976D2,stroke-width:3px,color:#000
    classDef backend fill:#E8F5E8,stroke:#388E3C,stroke-width:3px,color:#000
    classDef agent fill:#FFF3E0,stroke:#F57C00,stroke-width:3px,color:#000
    classDef retrieval fill:#FFF8E1,stroke:#FFA000,stroke-width:3px,color:#000
    classDef database fill:#FCE4EC,stroke:#C2185B,stroke-width:3px,color:#000
    classDef external fill:#F1F8E9,stroke:#689F38,stroke-width:3px,color:#000
    classDef evaluation fill:#F9FBE7,stroke:#AFB42B,stroke-width:3px,color:#000
    classDef metrics fill:#E0F2F1,stroke:#00695C,stroke-width:3px,color:#000
    
    class A,B userInterface
    class C,D,E,F,G,H,I,K,L backend
    class J1,J2,J3,J4,J5,J6,J7 retrieval
    class M,N database
    class O,P external
    class R,S,T,U evaluation
    class V metrics
    